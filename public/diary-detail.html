<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì¼ê¸° ìƒì„¸ ë³´ê¸° - í•œ ìˆ¨ì˜ ìœ„ë¡œ</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'emotion-happy': '#10B981',
            'emotion-sad': '#3B82F6',
            'emotion-angry': '#EF4444',
            'emotion-anxious': '#F59E0B',
            'emotion-neutral': '#6B7280'
          },
          animation: {
            'fade-in': 'fadeIn 0.5s ease-in-out',
            'slide-up': 'slideUp 0.4s ease-out',
            'bounce-in': 'bounceIn 0.6s ease-out'
          }
        }
      }
    }
  </script>
  <style>
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes bounceIn {
      0% { opacity: 0; transform: scale(0.3); }
      50% { opacity: 1; transform: scale(1.05); }
      70% { transform: scale(0.9); }
      100% { opacity: 1; transform: scale(1); }
    }

    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .glass-effect {
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.18);
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">
  <nav class="navbar">
    <div class="nav-container">
      <a href="dashboard.html" class="nav-brand">ğŸŒ™ í•œ ìˆ¨ì˜ ìœ„ë¡œ</a>
      <ul class="nav-menu">
        <li class="nav-item">
          <a href="dashboard.html" class="nav-link">ëŒ€ì‹œë³´ë“œ</a>
        </li>
        <li class="nav-item">
          <a href="write-diary.html" class="nav-link">ì¼ê¸° ì‘ì„±</a>
        </li>
        <li class="nav-item">
          <a href="my-diary.html" class="nav-link active">ë‚´ ì¼ê¸°</a>
        </li>
        <li class="nav-item">
          <a href="anonymous-community.html" class="nav-link">ìµëª… ì»¤ë®¤ë‹ˆí‹°</a>
        </li>
        <li class="nav-item">
          <a href="stats.html" class="nav-link">í†µê³„</a>
        </li>
        <li class="nav-item">
          <a href="my-page.html" class="nav-link">ë§ˆì´í˜ì´ì§€</a>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Main Container -->
  <div class="max-w-4xl mx-auto px-4 py-6 pt-24">
    <!-- Back Button -->
    <div class="mb-6 animate-fade-in">
      <a href="my-diary.html"
         class="inline-flex items-center space-x-2 text-indigo-600 hover:text-indigo-700 font-medium transition-all duration-300 hover:scale-105">
        <span>â†</span>
        <span>ë‚´ ì¼ê¸° ëª©ë¡ìœ¼ë¡œ</span>
      </a>
    </div>

    <!-- Header -->
    <div class="text-center mb-8 animate-fade-in">
      <div class="gradient-bg rounded-2xl p-8 text-white mb-6">
        <h1 class="text-3xl font-bold mb-2">ğŸ“˜ ì¼ê¸° ìƒì„¸ë³´ê¸°</h1>
        <p class="text-lg opacity-90">ë‚˜ì˜ ì†Œì¤‘í•œ ê°ì • ê¸°ë¡ì„ ë˜ëŒì•„ë³´ì„¸ìš”</p>
      </div>
    </div>

    <!-- Diary Content -->
    <div class="bg-white rounded-2xl p-8 shadow-lg mb-6 animate-slide-up">
      <!-- Diary Info Header -->
      <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-6 pb-6 border-b border-gray-200">
        <div class="flex items-center space-x-3 mb-4 sm:mb-0">
          <div class="w-12 h-12 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-full flex items-center justify-center text-white text-xl font-bold">
            ğŸ“
          </div>
          <div>
            <h2 class="text-xl font-bold text-gray-800">ê°ì • ì¼ê¸°</h2>
            <p class="text-gray-600">ë‚˜ì˜ ë§ˆìŒì„ ë‹´ì€ ê¸°ë¡</p>
          </div>
        </div>
        <div class="text-right">
          <div class="text-sm text-gray-500 mb-1">ì‘ì„±ì¼ì‹œ</div>
          <div id="created-at" class="font-semibold text-gray-800">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>
      </div>

      <!-- Emotion Badge -->
      <div class="mb-6">
        <div class="flex items-center space-x-3 mb-4">
          <span class="text-gray-700 font-medium">ğŸ’­ ê°ì • ìƒíƒœ:</span>
          <div id="emotion-badge" class="px-4 py-2 rounded-full text-sm font-medium bg-gray-100 text-gray-700">
            ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
          </div>
        </div>
      </div>

      <!-- Content -->
      <div class="mb-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center space-x-2">
          <span>ğŸ“</span>
          <span>ì¼ê¸° ë‚´ìš©</span>
        </h3>
        <div id="content" class="bg-gray-50 rounded-lg p-6 text-gray-700 leading-relaxed whitespace-pre-wrap min-h-[120px] flex items-center justify-center text-gray-500">
          ì¼ê¸° ë‚´ìš©ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
        </div>
      </div>
    </div>

    <!-- AI Feedback -->
    <div id="feedback-box" class="bg-white rounded-2xl p-6 shadow-lg mb-6 animate-slide-up hidden" style="animation-delay: 0.1s;">
      <div class="flex items-center space-x-3 mb-4">
        <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full flex items-center justify-center text-white text-lg font-bold">
          ğŸ¤–
        </div>
        <div>
          <h3 class="text-lg font-semibold text-gray-800">AI ê°ì • ë¶„ì„ ë° ì¶”ì²œ</h3>
          <p class="text-gray-600 text-sm">ë‹¹ì‹ ì˜ ë§ˆìŒì„ ì´í•´í•˜ê³  ìœ„ë¡œë¥¼ ì „í•©ë‹ˆë‹¤</p>
        </div>
      </div>
      <div id="feedback-content" class="bg-gradient-to-r from-blue-50 to-cyan-50 rounded-lg p-6 border-l-4 border-blue-400">
        <!-- AI feedback will be inserted here -->
      </div>
    </div>

    <!-- Actions -->
    <div class="text-center animate-slide-up" style="animation-delay: 0.2s;">
      <button id="chat-btn"
              class="px-8 py-4 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-xl font-semibold shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
        <span class="flex items-center justify-center space-x-3">
          <span>ğŸ’¬</span>
          <span>ì´ ì¼ê¸°ë¡œ AI ìƒë‹´ ì‹œì‘í•˜ê¸°</span>
          <span>â†’</span>
        </span>
      </button>

      <p class="mt-4 text-gray-500 text-sm">
        AIì™€ í•¨ê»˜ ë” ê¹Šì€ ê°ì • ëŒ€í™”ë¥¼ ë‚˜ëˆ„ì–´ë³´ì„¸ìš”
      </p>
    </div>
  </div>

  <script type="module">
    import { supabase } from './js/supabase.js';
    import { checkAuth } from './js/auth.js';

    checkAuth();

    const params = new URLSearchParams(location.search);
    const diaryId = params.get('id');
    const feedbackBox = document.getElementById('feedback-box');

    async function loadDiary() {
      if (!diaryId) return alert('ì¼ê¸°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');

      const { data, error } = await supabase.from('diaries').select('*').eq('id', diaryId).single();
      if (error || !data) return alert('ì¼ê¸° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨');

      const utc = new Date(data.created_at);
      const kst = new Date(utc.getTime() + 9 * 60 * 60 * 1000);
      document.getElementById('created-at').textContent = kst.toLocaleString('ko-KR', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        weekday: 'long',
        hour: '2-digit',
        minute: '2-digit'
      });

      // Emotion badge with color
      const emotionBadge = document.getElementById('emotion-badge');
      const emotionEmojis = {
        'happy': 'ğŸ˜Š í–‰ë³µ',
        'sad': 'ğŸ˜¢ ìŠ¬í””',
        'angry': 'ğŸ˜  ë¶„ë…¸',
        'anxious': 'ğŸ˜Ÿ ë¶ˆì•ˆ',
        'neutral': 'ğŸ˜ ë³´í†µ'
      };

      const emotionColors = {
        'happy': 'bg-emerald-100 text-emerald-700 border border-emerald-200',
        'sad': 'bg-blue-100 text-blue-700 border border-blue-200',
        'angry': 'bg-red-100 text-red-700 border border-red-200',
        'anxious': 'bg-amber-100 text-amber-700 border border-amber-200',
        'neutral': 'bg-gray-100 text-gray-700 border border-gray-200'
      };

      const emotionText = emotionEmojis[data.emotion] || data.emotion;
      const emotionColor = emotionColors[data.emotion] || 'bg-gray-100 text-gray-700 border border-gray-200';

      emotionBadge.textContent = emotionText;
      emotionBadge.className = `px-4 py-2 rounded-full text-sm font-medium ${emotionColor}`;

      const contentEl = document.getElementById('content');
      contentEl.textContent = data.content;
      contentEl.className = 'bg-gray-50 rounded-lg p-6 text-gray-700 leading-relaxed whitespace-pre-wrap min-h-[120px]';

      const res = await fetch('https://emotion-gpt-api.onrender.com/api/feedback', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ content: data.content })
      });

      const gpt = await res.json();
      if (gpt.feedback || gpt.music) {
        feedbackBox.classList.remove('hidden');
        document.getElementById('feedback-content').innerHTML = `
          <div class="space-y-4">
            <div>
              <h4 class="font-semibold text-gray-800 mb-2 flex items-center space-x-2">
                <span>ğŸ’­</span>
                <span>AI ê°ì • ë¶„ì„</span>
              </h4>
              <p class="text-gray-700 leading-relaxed">${gpt.feedback}</p>
            </div>
            ${gpt.music ? `
              <div class="pt-4 border-t border-blue-200">
                <h4 class="font-semibold text-gray-800 mb-3 flex items-center space-x-2">
                  <span>ğŸµ</span>
                  <span>ì¶”ì²œ ìŒì•…</span>
                </h4>
                <a href="${gpt.music}" target="_blank"
                   class="inline-flex items-center space-x-2 px-4 py-3 bg-gradient-to-r from-green-500 to-teal-500 text-white rounded-lg font-medium shadow-md hover:shadow-lg transition-all duration-300 transform hover:scale-105">
                  <span>â–¶ï¸</span>
                  <span>ìŒì•… ë“¤ìœ¼ëŸ¬ ê°€ê¸°</span>
                  <span>â†’</span>
                </a>
              </div>
            ` : ''}
          </div>
        `;
      }
    }

    document.getElementById('chat-btn').addEventListener('click', () => {
      location.href = `chat.html?id=${diaryId}`;
    });

    loadDiary();
  </script>
</body>
</html>
